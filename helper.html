<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8' />
    <title>MapLibre Location Helper</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <link rel="icon" type="image/svg+xml" href="https://maplibre.org/favicon.ico">
    <script src='https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.js'></script>
    <link href='https://unpkg.com/maplibre-gl@4.7.1/dist/maplibre-gl.css' rel='stylesheet' />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }

        #info-panel {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            z-index: 1;
            max-width: 400px;
            font-size: 14px;
        }

        #info-panel h3 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        #info-panel p {
            margin: 5px 0;
            color: #666;
            font-size: 13px;
        }

        #location-output {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            line-height: 1.6;
            margin-top: 10px;
            white-space: pre-wrap;
            word-break: break-all;
            border: 1px solid #e0e0e0;
        }

        #copy-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #3FB1CE;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.2s;
        }

        #copy-btn:hover {
            background: #2d8fa8;
        }

        #copy-btn:active {
            background: #237a91;
        }

        .copied {
            background: #4CAF50 !important;
        }

        #style-selector {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        #style-selector label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        #style-selector select {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        .maplibregl-ctrl-group {
            margin: 10px;
        }

        #search-container {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e0e0e0;
        }

        #search-container label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        #search-input {
            width: calc(100% - 18px);
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
            font-size: 13px;
        }

        #search-results {
            max-height: 150px;
            overflow-y: auto;
            margin-top: 5px;
            border-radius: 4px;
        }

        .search-result {
            padding: 8px 10px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }

        .search-result:hover {
            background: #f0f0f0;
        }

        .search-result:last-child {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <div id="info-panel">
        <h3>MapLibre Location Helper</h3>
        <p>Navigate the map to capture the current view settings. Pan, zoom, rotate (right-click + drag), and pitch (ctrl + drag) the map to get your desired view.</p>

        <div id="search-container">
            <label for="search-input">Search Location:</label>
            <input type="text" id="search-input" placeholder="Enter a place name..." />
            <div id="search-results"></div>
        </div>

        <div id="style-selector">
            <label for="style-select">Map Style:</label>
            <select id="style-select">
                <option value="https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json">Carto Voyager (Colorful)</option>
                <option value="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json">Carto Positron (Light)</option>
                <option value="https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json">Carto Dark Matter</option>
                <option value="https://tiles.openfreemap.org/styles/liberty">OpenFreeMap Liberty</option>
                <option value="https://tiles.openfreemap.org/styles/bright">OpenFreeMap Bright</option>
                <option value="https://tiles.openfreemap.org/styles/positron">OpenFreeMap Positron</option>
            </select>
        </div>

        <div id="location-output">Move the map to see location data...</div>

        <button id="copy-btn" onclick="copyToClipboard()">Copy to Clipboard</button>
    </div>

    <script>
        var map = new maplibregl.Map({
            container: 'map',
            style: 'https://basemaps.cartocdn.com/gl/voyager-gl-style/style.json',
            center: [-122.4194, 37.7749],
            zoom: 10,
            pitch: 0,
            bearing: 0
        });

        // Add navigation controls
        map.addControl(new maplibregl.NavigationControl(), 'top-right');
        map.addControl(new maplibregl.ScaleControl(), 'bottom-left');
        map.addControl(new maplibregl.FullscreenControl(), 'top-right');

        // Update location output on map move
        function updateLocationOutput() {
            var center = map.getCenter();
            var zoom = map.getZoom();
            var pitch = map.getPitch();
            var bearing = map.getBearing();

            var output = `location: {
    center: [${center.lng.toFixed(5)}, ${center.lat.toFixed(5)}],
    zoom: ${zoom.toFixed(2)},
    pitch: ${pitch.toFixed(2)},
    bearing: ${bearing.toFixed(2)}
}`;

            document.getElementById('location-output').textContent = output;
        }

        map.on('moveend', updateLocationOutput);
        map.on('load', updateLocationOutput);

        // Copy to clipboard functionality
        function copyToClipboard() {
            var output = document.getElementById('location-output').textContent;
            navigator.clipboard.writeText(output).then(function () {
                var btn = document.getElementById('copy-btn');
                btn.textContent = 'Copied!';
                btn.classList.add('copied');
                setTimeout(function () {
                    btn.textContent = 'Copy to Clipboard';
                    btn.classList.remove('copied');
                }, 2000);
            });
        }

        // Style selector
        document.getElementById('style-select').addEventListener('change', function (e) {
            map.setStyle(e.target.value);
        });

        // Search functionality using Nominatim (OpenStreetMap)
        var searchInput = document.getElementById('search-input');
        var searchResults = document.getElementById('search-results');
        var searchTimeout = null;

        searchInput.addEventListener('input', function (e) {
            clearTimeout(searchTimeout);
            var query = e.target.value.trim();

            if (query.length < 3) {
                searchResults.innerHTML = '';
                return;
            }

            searchTimeout = setTimeout(function () {
                fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(query) + '&limit=5')
                    .then(response => response.json())
                    .then(data => {
                        searchResults.innerHTML = '';
                        data.forEach(function (item) {
                            var div = document.createElement('div');
                            div.className = 'search-result';
                            div.textContent = item.display_name;
                            div.addEventListener('click', function () {
                                map.flyTo({
                                    center: [parseFloat(item.lon), parseFloat(item.lat)],
                                    zoom: 12
                                });
                                searchResults.innerHTML = '';
                                searchInput.value = item.display_name.split(',')[0];
                            });
                            searchResults.appendChild(div);
                        });
                    })
                    .catch(err => console.error('Search error:', err));
            }, 300);
        });

        // Close search results when clicking outside
        document.addEventListener('click', function (e) {
            if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
                searchResults.innerHTML = '';
            }
        });
    </script>

</body>

</html>
